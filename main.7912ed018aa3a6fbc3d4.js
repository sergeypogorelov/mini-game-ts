!function(){"use strict";var e={411:function(e,t,n){t.Z=n.p+"assets/images/level-demo.c109a2fa11de5e2fe5cab5c3f523fa96.png"},537:function(e,t,n){t.Z=n.p+"assets/sprites/crystal-blue.af895ca3686b6d42b27c5d71c94d9cf4.png"},635:function(e,t,n){t.Z=n.p+"assets/sprites/crystal-green.2dc54d5f76a41ce5ec2f3b5cd6282ed9.png"},465:function(e,t,n){t.Z=n.p+"assets/sprites/crystal-grey.f42b27cbd2ff502508f6ae7fb66f89b4.png"},647:function(e,t,n){t.Z=n.p+"assets/sprites/crystal-red.dd9f24bac070cf32da12dea9c683b9dd.png"},965:function(e,t,n){t.Z=n.p+"assets/sprites/explosion.9866389c62f3df6cff68df5c5828f521.png"}},t={};function n(r){var i=t[r];if(void 0!==i)return i.exports;var o=t[r]={exports:{}};return e[r](o,o.exports,n),o.exports}n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),function(){var e;n.g.importScripts&&(e=n.g.location+"");var t=n.g.document;if(!e&&t&&(t.currentScript&&(e=t.currentScript.src),!e)){var r=t.getElementsByTagName("script");r.length&&(e=r[r.length-1].src)}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),n.p=e}(),function(){var e,t,r=n(411).Z,i=n(647).Z,o=[[0,0,32,32],[32,0,32,32],[64,0,32,32],[96,0,32,32],[128,0,32,32],[160,0,32,32],[192,0,32,32],[224,0,32,32]],s=n(635).Z,a=[[0,0,32,32],[32,0,32,32],[64,0,32,32],[96,0,32,32],[128,0,32,32],[160,0,32,32],[192,0,32,32],[224,0,32,32]],c=n(537).Z,u=[[0,0,32,32],[32,0,32,32],[64,0,32,32],[96,0,32,32],[128,0,32,32],[160,0,32,32],[192,0,32,32],[224,0,32,32]],l=n(465).Z,f=[[0,0,32,32],[32,0,32,32],[64,0,32,32],[96,0,32,32],[128,0,32,32],[160,0,32,32],[192,0,32,32],[224,0,32,32]],p=n(965).Z,h=[[0,0,100,100],[100,0,100,100],[200,0,100,100],[300,0,100,100],[400,0,100,100],[0,100,100,100],[100,100,100,100],[200,100,100,100],[300,100,100,100],[400,100,100,100],[0,200,100,100],[100,200,100,100],[200,200,100,100],[300,200,100,100],[400,200,100,100],[0,300,100,100],[100,300,100,100],[200,300,100,100],[300,300,100,100],[400,300,100,100],[0,400,100,100],[100,400,100,100],[200,400,100,100],[300,400,100,100],[400,400,100,100]],d=function(e,t){this.x=e,this.y=t},y=function(e,t){if(e<=0)throw new Error("Width should be greater tnan 0.");if(this.width=e,t<=0)throw new Error("Height should be greater than 0.");this.height=t},g=function(){function e(){this._callbacks=[]}return e.prototype.attach=function(e){var t=this;if(!e)throw new Error("Callback is not specified.");var n=function(t){e(t)};return this._callbacks.push(n),{detach:function(){t._callbacks=t._callbacks.filter((function(e){return e===n}))}}},e.prototype.emit=function(e){this._callbacks.forEach((function(t){return t(e)}))},e}(),m=function(){function e(){}return e.getRandomInteger=function(e,t){return e=Math.ceil(e),t=Math.floor(t),Math.floor(Math.random()*(t-e+1))+e},e.checkTouch=function(e,t,n){if(!e)throw new Error("Point is not specified.");if(!t)throw new Error("Target point is not specified.");if(!n)throw new Error("Target size is not specified.");var r=e.x,i=e.y,o=t.x,s=t.y,a=n.width,c=n.height;return r>=o&&r<=o+a&&i>=s&&i<=s+c},e}(),w=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function s(e){try{c(r.next(e))}catch(e){o(e)}}function a(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}c((r=r.apply(e,t||[])).next())}))},b=function(e,t){var n,r,i,o,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,r=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!(i=s.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){s=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){s.label=o[1];break}if(6===o[0]&&s.label<i[1]){s.label=i[1],i=o;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(o);break}i[2]&&s.ops.pop(),s.trys.pop();continue}o=t.call(e,s)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}},v=function(){function e(e,t){this.onVictory=new g,this.onDefeat=new g,this.setAssetsManager(e),this.setSize(t)}return Object.defineProperty(e.prototype,"isLoaded",{get:function(){return this._isLoaded},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"size",{get:function(){return this._size},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"assetsManager",{get:function(){return this._assetsManager},enumerable:!1,configurable:!0}),e.prototype.load=function(){return w(this,void 0,void 0,(function(){return b(this,(function(e){switch(e.label){case 0:return this._isLoaded=!1,[4,this.assetsManager.load(this.imageIds)];case 1:return e.sent(),[4,this.loadEntities()];case 2:return e.sent(),this._isLoaded=!0,[2,this]}}))}))},e.prototype.setSize=function(e){if(!e)throw new Error("Level size is not specified.");this._size=e},e.prototype.setAssetsManager=function(e){if(!e)throw new Error("Assets manager is not specified.");this._assetsManager=e},e}(),_=function(){function e(e,t){this.onDisposalReady=new g,this.setLocation(e),this.setSize(t)}return Object.defineProperty(e.prototype,"location",{get:function(){return this._location},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"size",{get:function(){return this._size},enumerable:!1,configurable:!0}),e.prototype.setLocation=function(e){if(!e)throw new Error("Location is not specified.");this._location=e},e.prototype.setSize=function(e){if(!e)throw new Error("Size is not specified.");this._size=e},e}(),E=(e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(t,n)},function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)});!function(e){e.Crystal="crystal",e.EmptyCell="empty-cell"}(t||(t={}));var x,P,S=function(e){function t(t,n,r){var i=e.call(this,n,r)||this;return i.setType(t),i}return E(t,e),Object.defineProperty(t.prototype,"type",{get:function(){return this._type},enumerable:!1,configurable:!0}),t.prototype.checkNeighbor=function(e){if(!e)throw new Error("Entity is not specified.");for(var n=0,r=t.closestEntitiesPredicates;n<r.length;n++){if((0,r[n])(this,e))return!0}return!1},t.prototype.changeLocation=function(e){this.setLocation(e)},t.prototype.setType=function(e){if(!e)throw new Error("Type is not specified.");this._type=e},t.defSize=new y(5,5),t.closestEntitiesPredicates=[function(e,n){return e.location.x===n.location.x&&e.location.y-t.defSize.height===n.location.y},function(e,n){return e.location.x+t.defSize.width===n.location.x&&e.location.y===n.location.y},function(e,n){return e.location.x===n.location.x&&e.location.y+t.defSize.height===n.location.y},function(e,n){return e.location.x-t.defSize.width===n.location.x&&e.location.y===n.location.y}],t}(_),I=function(){function e(e,t){this.setImage(e),this.setFrames(t)}return Object.defineProperty(e.prototype,"framesAreReversed",{get:function(){return this._framesAreReversed},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"frames",{get:function(){var e=this._frames.slice();return this.framesAreReversed?e.reverse():e},set:function(e){this.setFrames(e)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"image",{get:function(){return this._image},set:function(e){this.setImage(e)},enumerable:!1,configurable:!0}),e.createFromArray=function(t,n){if(!t)throw new Error("Image is not specified.");if(!n)throw new Error("Frames are not specified.");return new e(t,n.map((function(e){return{srcPoint:new d(e[0],e[1]),srcSize:new y(e[2],e[3])}})))},e.prototype.setReversedOrderOfFrames=function(){this.framesAreReversed||(this._framesAreReversed=!0)},e.prototype.setDefaultOrderOfFrames=function(){this.framesAreReversed&&(this._framesAreReversed=!1)},e.prototype.setFrames=function(e){if(!e)throw new Error("Sprite frames are not specified.");if(0===e.length)throw new Error("Sprite frames are not found.");this._frames=e.slice()},e.prototype.setImage=function(e){if(!e)throw new Error("Image is not specified.");this._image=e},e}(),C=function(){function e(){this.onTickBeforeUpdate=new g,this.onTickAfterUpdate=new g,this.reset()}return e.prototype.reset=function(){this.timePassed=0},e.prototype.update=function(e){this.timePassed+=e},e}(),O=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),z=function(e){function t(t){var n=e.call(this)||this;return n.setFrequency(t),n}return O(t,e),Object.defineProperty(t.prototype,"frequency",{get:function(){return this._frequency},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"counter",{get:function(){return this._counter},enumerable:!1,configurable:!0}),t.prototype.checkTick=function(e){return Math.floor((this.timePassed+e)/this.frequency)>this.counter},t.prototype.update=function(t){var n=this.checkTick(t);n&&(this._counter++,this.onTickBeforeUpdate.emit(this._counter)),e.prototype.update.call(this,t),n&&this.onTickAfterUpdate.emit(this._counter)},t.prototype.reset=function(){e.prototype.reset.call(this),this._counter=0},t.prototype.setFrequency=function(e){if(!e&&"number"!=typeof e)throw new Error("Frequency is not specified.");if(e<=0)throw new Error("Frequency should more than zero.");this._frequency=e},t}(C),j=function(){function e(e){this.onAnimationFinish=new g,this._isFinished=!1,this._shouldPreventUpdateOnce=!1,this._currentFrameIndex=0,this._forcedFrameIndex=null,this.setConfig(e),this.setSchedules()}return e.prototype.isFinished=function(){return this._isFinished},Object.defineProperty(e.prototype,"timePerFrame",{get:function(){return 1e3/this._config.speed},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"timePerAllFrames",{get:function(){return this.timePerFrame*this._config.sprite.frames.length},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"countOfFrames",{get:function(){return this._config.sprite.frames.length},enumerable:!1,configurable:!0}),e.prototype.getCurrentFrame=function(){var e=this._currentFrameIndex;"number"==typeof this._forcedFrameIndex&&(e=this._forcedFrameIndex);var t=this._config.sprite.frames;return e>=t.length&&(e=t.length-1,console.error(this)),t[e]},e.prototype.update=function(e){this.isPaused||(this._shouldPreventUpdateOnce?this._shouldPreventUpdateOnce=!1:this._isFinished||(this._singleFrameSchedule.update(e),this._allFramesSchedule.update(e)))},e.prototype.render=function(e,t,n){var r=this.getCurrentFrame(),i=r.srcPoint,o=r.srcSize,s={image:this._config.sprite.image,srcPointInPixels:i,srcSizeInPixels:o,destPointInUnits:t,destSizeInUnits:n};e.render(s)},e.prototype.reset=function(){this._currentFrameIndex=0,this._singleFrameSchedule.reset(),this._allFramesSchedule.reset()},e.prototype.forceFrameIndex=function(e){if(e<0)throw new Error("Frame index cannot be less than 0.");if(e>=this.countOfFrames)throw new Error("Frame index is out of range.");this.isPaused=!0,this._forcedFrameIndex=e},e.prototype.unforceFrameIndex=function(){this.isPaused=!1,this._forcedFrameIndex=null},e.prototype.setFramesOrder=function(e){var t=this._config.sprite;e?t.setDefaultOrderOfFrames():t.setReversedOrderOfFrames()},e.prototype.setConfig=function(t){var n,r;if(!t)throw new Error("Sprite animation config is not defined.");if(!t.sprite)throw new Error("Sprite is not found in sprite animation config.");this._config={sprite:t.sprite,speed:null!==(n=t.speed)&&void 0!==n?n:e.defSpeed,isInfinite:null!==(r=t.isInfinite)&&void 0!==r&&r}},e.prototype.setSchedules=function(){var e=this;this._singleFrameSchedule=new z(this.timePerFrame),this._singleFrameSchedule.onTickBeforeUpdate.attach((function(){e._currentFrameIndex++})),this._allFramesSchedule=new z(this.timePerAllFrames),this._allFramesSchedule.onTickBeforeUpdate.attach((function(){e._config.isInfinite?e.reset():(e._isFinished=!0,e.onAnimationFinish.emit(e)),e._shouldPreventUpdateOnce=!0}))},e.defSpeed=12,e}(),F=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();!function(e){e.Grey="grey",e.Red="red",e.Green="green",e.Blue="blue"}(x||(x={})),function(e){e.Top="top",e.Left="left"}(P||(P={}));var L=function(e){function n(r){var i=e.call(this,t.Crystal,null==r?void 0:r.location,n.defSize)||this;return i.setColor(null==r?void 0:r.color),i.setSpriteAnimation(null==r?void 0:r.spriteImage,null==r?void 0:r.spriteFrames),i.setExplosionSpriteAnimation(null==r?void 0:r.explosionSpriteImage,null==r?void 0:r.explosionSpriteFrames),i}return F(n,e),Object.defineProperty(n.prototype,"isFrozen",{get:function(){return this._isFrozen},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"isLeaving",{get:function(){return this._isLeaving},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"isExploding",{get:function(){return this._isExploding},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"color",{get:function(){return this._color},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"spriteAnimation",{get:function(){return this._spriteAnimation},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"explosionSpriteAnimation",{get:function(){return this._explosionSpriteAnimation},enumerable:!1,configurable:!0}),n.prototype.update=function(e){this.isExploding?this.explosionSpriteAnimation.update(e):(this.spriteAnimation.update(e),this.isLeaving&&this.updateLeavingLocation(e))},n.prototype.render=function(e){this.isExploding?this.explosionSpriteAnimation.render(e,this.location,this.size):this.spriteAnimation.render(e,this.location,this.size)},n.prototype.destroy=function(){if(!this.isLeaving){this._isLeaving=!0;var e=Object.values(P),t=m.getRandomInteger(0,e.length-1);this._leavingDirection=e[t]}},n.prototype.checkSwap=function(e){return!!this.checkNeighbor(e)&&(this.color!==x.Grey&&(e.type===t.EmptyCell||e.type===t.Crystal&&e.color!==x.Grey))},n.prototype.freeze=function(){this._isFrozen=!0,this.spriteAnimation.isPaused=!0},n.prototype.unfreeze=function(){this._isFrozen=!1,this.spriteAnimation.isPaused=!1},n.prototype.updateLeavingLocation=function(e){if(this.isLeaving&&!this.isExploding){var t=this.location,r=t.x,i=t.y;if(r<=0||i<=0)this._isExploding=!0;else{var o=r,s=i;this._leavingDirection===P.Top?s=i-n.leavingSpeed*e/1e3:this._leavingDirection===P.Left&&(o=r-n.leavingSpeed*e/1e3),this.changeLocation(new d(o,s))}}},n.prototype.setColor=function(e){if(!e)throw new Error("Crystal color is not specified.");this._color=e},n.prototype.setSpriteAnimation=function(e,t){if(!e)throw new Error("Sprite image is not specified.");if(!t)throw new Error("Sprite frames are not specified.");var r=I.createFromArray(e,t),i=n.animationSpeedByColorMap.get(this.color);if(this._spriteAnimation=new j({sprite:r,speed:i,isInfinite:!0}),this.color===x.Grey){var o=this.spriteAnimation,s=m.getRandomInteger(0,o.countOfFrames-1);o.forceFrameIndex(s)}},n.prototype.setExplosionSpriteAnimation=function(e,t){var r=this;if(!e)throw new Error("Explosion sprite image is not specified.");if(!t)throw new Error("Explosion sprite frames are not specified.");var i=I.createFromArray(e,t),o=n.explosionAnimationSpeed;this._explosionSpriteAnimation=new j({sprite:i,speed:o}),this._explosionSpriteAnimation.onAnimationFinish.attach((function(){r.onDisposalReady.emit()}))},n.leavingSpeed=6,n.explosionAnimationSpeed=15,n.spriteUrlPerColorMap=new Map([[x.Grey,l],[x.Red,i],[x.Green,s],[x.Blue,c]]),n.spriteFramesPerColorMap=new Map([[x.Grey,f],[x.Red,o],[x.Green,a],[x.Blue,u]]),n.animationSpeedByColorMap=new Map([[x.Grey,0],[x.Red,24],[x.Green,18],[x.Blue,22]]),n}(S),A=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),R=function(e){function n(r){return e.call(this,t.EmptyCell,r,n.defSize)||this}return A(n,e),n.prototype.update=function(e){},n.prototype.render=function(e){},n.prototype.destroy=function(){this.onDisposalReady.emit()},n.prototype.checkSwap=function(e){if(!e)throw new Error("Entity is not specified.");return!1},n}(S),M=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),k=function(e,t){for(var n=0,r=t.length,i=e.length;n<r;n++,i++)e[i]=t[n];return e},T=function(e){function n(t){var o=e.call(this,t,n.defSize)||this;return o.imageIds=[r,i,s,c,l,p],o.setEventHandlers(),o}return M(n,e),n.prototype.update=function(e){this._targetCrystals.forEach((function(t){t.update(e)})),this._entities.forEach((function(t){t.update(e)}))},n.prototype.render=function(e){e.clearContext(),this.renderBackground(e),this.renderEntities(e)},n.prototype.touch=function(e){var t=this._entities.find((function(t){var n=t.location,r=t.size;return m.checkTouch(e,n,r)}));t?this._onTouch.emit(t):this._onFailedTouch.emit()},n.prototype.loadEntities=function(){this._bgImg=this.assetsManager.getImage(r);for(var e=[],t=[],n=this.getColors(),i=this.generateCrystals(),o=this.getMatrixData(),s=o.matrixLength,a=o.xIndent,c=o.yIndent,u=o.yIndentForMatrix,l=0;l<s;l+=2){var f=new d(l*S.defSize.width+a,c),p=n.pop();(b=this.createCrystal(f,p)).spriteAnimation.setFramesOrder(!1),e.push(b)}for(l=0;l<s;l++)for(var h=S.defSize,y=h.width,g=h.height,m=0;m<s;m++){var w=new d(m*y+a,l*g+c+g+u);if(m%2==0)(b=i.pop()).changeLocation(w),t.push(b);else if(l%2==0){var b=this.createCrystal(w,x.Grey);t.push(b)}else{var v=new R(w);t.push(v)}}return this._targetCrystals=e,this._entities=t,Promise.resolve()},n.prototype.getColors=function(e){void 0===e&&(e=!0);var t=[x.Red,x.Green,x.Blue];return e?t.sort((function(){return m.getRandomInteger(-1,1)})):t},n.prototype.getMatrixData=function(){var e=2*this.getColors().length-1,t=.5*S.defSize.height,n=e*S.defSize.width,r=e*S.defSize.height+S.defSize.height+t;return{matrixLength:e,matrtixWidth:n,matrixHeight:r,xIndent:Math.floor((this.size.width-n)/2),yIndent:Math.floor((this.size.height-r)/2),yIndentForMatrix:t}},n.prototype.renderBackground=function(e){if(!e)throw new Error("Renderer is not specified.");var t={image:this._bgImg,srcPointInPixels:new d(0,0),srcSizeInPixels:this._bgImg.size,destPointInUnits:new d(0,0),destSizeInUnits:this.size};e.render(t)},n.prototype.renderEntities=function(e){if(!e)throw new Error("Renderer is not specified.");this._targetCrystals.forEach((function(t){t.render(e)})),this._entities.forEach((function(t){t.render(e)}))},n.prototype.generateCrystals=function(){for(var e=[],t=this.getColors(!1),n=2*t.length-1,r=0;r<t.length;r++)for(var i=t[r],o=0;o<n;o++){var s=this.createCrystal(new d(0,0),i);e.push(s)}return e.sort((function(){return m.getRandomInteger(-1,1)}))},n.prototype.createCrystal=function(e,t){if(!e)throw new Error("Crystal location is not specified.");if(!t)throw new Error("Crystal color is not specified.");var n=L.spriteUrlPerColorMap,r=L.spriteFramesPerColorMap,i=this.assetsManager.getImage(n.get(t)),o=r.get(t),s=this.assetsManager.getImage(p);return new L({spriteImage:i,spriteFrames:o,explosionSpriteImage:s,explosionSpriteFrames:h,color:t,location:e})},n.prototype.checkIfRiddleIsSolved=function(){var e=S.defSize,n=e.width,r=e.height,i=this.getMatrixData(),o=i.matrixLength,s=i.xIndent,a=i.yIndent,c=i.yIndentForMatrix,u=[];this._entities.forEach((function(e){var t=e.location,i=t.x,o=(t.y-a-c-r)/r,l=(i-s)/n;u[l]||(u[l]=[]),u[l][o]=e}));for(var l=this._targetCrystals.slice(),f=function(e){var n=l.shift().color;if(!u[e].every((function(e){return e.type===t.Crystal&&e.color===n})))return{value:!1}},p=0;p<o;p+=2){var h=f(p);if("object"==typeof h)return h.value}return!0},n.prototype.setEventHandlers=function(){var e=this;this._onTouch=new g,this._onFailedTouch=new g,this._onSwapCheck=new g,this._onSwap=new g,this._onTouch.attach((function(n){if(e._touchedCrystal)e._onSwapCheck.emit(n);else if(n.type===t.Crystal){var r=n;r.freeze(),e._touchedCrystal=r}else e._onFailedTouch.emit()})),this._onFailedTouch.attach((function(){var t=e._touchedCrystal;t&&(t.unfreeze(),e._touchedCrystal=null)})),this._onSwapCheck.attach((function(t){var n=e._touchedCrystal;if(n.checkSwap(t)){var r=n.location;n.changeLocation(t.location),t.changeLocation(r),e._onSwap.emit()}e._onFailedTouch.emit()})),this._onSwap.attach((function(){e.checkIfRiddleIsSolved()&&(e.onVictory.emit(),k(k([],e._entities),e._targetCrystals).forEach((function(t){t.onDisposalReady.attach((function(){e._targetCrystals=e._targetCrystals.filter((function(e){return e!==t})),e._entities=e._entities.filter((function(e){return e!==t}))})),t.destroy()})))}))},n.defSize=new y(70,40),n}(v),U=function(){function e(e,t,n){this.setContext(e),this.setSizeInPixels(t),this.setSizeInUnits(n),this.recalculate()}return Object.defineProperty(e.prototype,"sizeInUnits",{get:function(){return this._sizeInUnits},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"sizeInPixels",{get:function(){return this._sizeInPixels},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"adjustedSizeInPixels",{get:function(){return this._adjustedSizeInPixels},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"xIndent",{get:function(){return this._xIndent},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"yIndent",{get:function(){return this._yIndent},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"xMultiplier",{get:function(){return this._xMultiplier},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"yMultiplier",{get:function(){return this._yMultiplier},enumerable:!1,configurable:!0}),e.prototype.changeSizeInPixels=function(e){this.setSizeInPixels(e),this.recalculate()},e.prototype.changeSizeInUnits=function(e){this.setSizeInUnits(e),this.recalculate()},e.prototype.castUnitPointToPixel=function(e){if(!e)throw new Error("Point in units is not defined.");var t=this,n=t.xIndent,r=t.yIndent,i=t.xMultiplier,o=t.yMultiplier;return new d(e.x*i+n,e.y*o+r)},e.prototype.castUnitSizeToPixel=function(e){if(!e)throw new Error("Size in units is not defined.");var t=this.xMultiplier,n=this.yMultiplier;return new y(e.width*t,e.height*n)},e.prototype.castPixelPointToUnit=function(e){if(!e)throw new Error("Point in pixels is not defined.");var t=this,n=t.xIndent,r=t.yIndent,i=t.xMultiplier,o=t.yMultiplier;return new d((e.x-n)/i,(e.y-r)/o)},e.prototype.castPixelSizeToUnit=function(e){if(!e)throw new Error("Size in pixels is not defined.");var t=this.xMultiplier,n=this.yMultiplier;return new y(e.width/t,e.height/n)},e.prototype.clearContext=function(){this._context.clear()},e.prototype.render=function(e){if(!e)throw new Error("Render params are not defined.");var t=e.image,n=e.srcPointInPixels,r=e.srcSizeInPixels,i=e.destPointInUnits,o=e.destSizeInUnits;if(!t)throw new Error("Image for rendering is not defined.");if(!n)throw new Error("Source point for rendering is not defined.");if(!r)throw new Error("Source size for rendering is not defined.");if(!i)throw new Error("Destination point for rendering is not defined.");if(!o)throw new Error("Destination size for rendering is not defined.");var s={image:t,srcPoint:n,srcSize:r,destPoint:this.castUnitPointToPixel(i),destSize:this.castUnitSizeToPixel(o)};this._context.drawImage(s)},e.prototype.setContext=function(e){if(!e)throw new Error("Context for rendering is not defined.");this._context=e},e.prototype.setSizeInUnits=function(e){if(!e)throw new Error("Size in units is not defined.");this._sizeInUnits=e},e.prototype.setSizeInPixels=function(e){if(!e)throw new Error("Size in pixels is not defined.");this._sizeInPixels=e},e.prototype.recalculate=function(){var e=this.sizeInUnits,t=this.sizeInPixels,n=t.height*e.width/e.height;if(n<=t.width)this._adjustedSizeInPixels=new y(n,t.height),this._xIndent=(t.width-n)/2,this._yIndent=0;else{var r=t.width*e.height/e.width;if(!(r<=t.height))throw new Error("Renderer cannot calculate resolution for rendering.");this._adjustedSizeInPixels=new y(t.width,r),this._yIndent=(t.height-r)/2,this._xIndent=0}this._xMultiplier=this._adjustedSizeInPixels.width/e.width,this._yMultiplier=this._adjustedSizeInPixels.height/e.height},e}(),D=function(){function e(e){this.onError=new g,this.setEngineConfig(e),this.initEngineConfig()}return Object.defineProperty(e.prototype,"isUpdatingEnabled",{get:function(){return this._isUpdatingEnabled},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isRenderingEnabled",{get:function(){return this._isRenderingEnabled},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isUpdateable",{get:function(){var e;return Boolean(null===(e=this.currentLevel)||void 0===e?void 0:e.isLoaded)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isRenderable",{get:function(){var e;return Boolean(null===(e=this.currentLevel)||void 0===e?void 0:e.isLoaded)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"currentLevel",{get:function(){return this._currentLevel},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"renderer",{get:function(){return this._renderer},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"engineConfig",{get:function(){return this._engineConfig},enumerable:!1,configurable:!0}),e.prototype.changeCurrentLevel=function(e){var t=this;if(!e)throw new Error("Level is not specified.");if(this.isUpdatingEnabled)throw new Error("Cannot change level as updating is enabled.");if(this.isRenderingEnabled)throw new Error("Cannot change level as rendering is enabled.");if(this._currentLevel&&this._currentLevel.assetsManager.clear(),this._currentLevel=e,this.renderer)this.renderer.changeSizeInUnits(e.size);else{var n=new U(this.engineConfig.graphicContext,this.engineConfig.resolutionWacther.currentResolution,e.size);this.setRenderer(n),this.engineConfig.resolutionWacther.onChange.attach((function(e){t.renderer.changeSizeInPixels(e)}))}},e.prototype.setUpdatingStatus=function(e){this._isUpdatingEnabled=e},e.prototype.setRenderingStatus=function(e){this._isRenderingEnabled=e},e.prototype.setRenderer=function(e){if(!e)throw new Error("Renderer is not specified.");this._renderer=e},e.prototype.setEngineConfig=function(e){if(!e)throw new Error("Engine config is not specified.");this._engineConfig=e},e.prototype.initEngineConfig=function(){var e=this;this.engineConfig.animator.onBeforeRepaint.attach((function(t){try{e.isUpdatingEnabled&&e.isUpdateable&&e.currentLevel.update(t),e.isRenderingEnabled&&e.isRenderable&&e.currentLevel.render(e.renderer)}catch(t){throw t instanceof Error&&e.onError.emit(t),t}})),this.engineConfig.playerInput.onScreenTouch.attach((function(t){try{if(e.currentLevel){var n=e.renderer.castPixelPointToUnit(t);e.currentLevel.touch(n)}}catch(t){throw t instanceof Error&&e.onError.emit(t),t}}))},e}(),B=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),G=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return B(t,e),t}(D),H=function(){function e(){this.onBeforeRepaint=new g}return Object.defineProperty(e.prototype,"isRunning",{get:function(){return Boolean(this._prevDate)},enumerable:!1,configurable:!0}),e.prototype.startAnimating=function(){if(this.isRunning)throw new Error("Animator has been already started.");this._prevDate=new Date,this._isFirstEmit=!0,this.emit()},e.prototype.stopAnimating=function(){if(!this.isRunning)throw new Error("Animator has not been started yet.");this._prevDate=null},e.prototype.emit=function(){var e=this;if(this._isFirstEmit)return this._isFirstEmit=!1,void requestAnimationFrame((function(){return e.emit()}));if(this._prevDate){var t=new Date,n=t.getTime()-this._prevDate.getTime();this.onBeforeRepaint.emit(n),this._prevDate=t,requestAnimationFrame((function(){return e.emit()}))}},e}(),q=function(){function e(){this.imageStoreMap=new Map}return e.prototype.getImage=function(e){return this.imageStoreMap.get(e)},e.prototype.clear=function(){this.imageStoreMap.clear()},e}(),W=function(e,t){if(!e)throw new Error("Image id is not specified.");if(this.id=e,!t)throw new Error("Image size is not specified.");this.size=t},Z=function(){function e(){this._loading=!1}return Object.defineProperty(e.prototype,"loading",{get:function(){return this._loading},enumerable:!1,configurable:!0}),e.prototype.load=function(e){var t=this;if(!e)throw new Error("URLs are not specified.");if(this.loading)throw new Error("Loading is already in progress.");if(0===e.length)return Promise.resolve([]);this._loading=!0;var n=e.map((function(e){return t.loadByUrl(e)}));return Promise.all(n).finally((function(){return t._loading=!1}))},e}(),V=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),N=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return V(t,e),t.prototype.loadByUrl=function(e){var t=this;if(!e)throw new Error("Url is not specified.");return new Promise((function(n,r){var i=new Audio;i.oncanplaythrough=function(){t.handleAudioLoad(e,i),n(i)},i.onerror=function(n){t.handleAudioLoad(e,i),r(n)},i.controls=!1,i.preload="auto",i.style.display="none",i.src=e,document.body.appendChild(i)}))},t.prototype.handleAudioLoad=function(e,t){if(!e)throw new Error("Url is not defined.");if(!t)throw new Error("Audio element is not defined.");document.body.contains(t)&&(document.body.removeChild(t),t.removeAttribute("style"))},t}(Z),$=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),J=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return $(t,e),t.prototype.loadByUrl=function(e){var t=this;if(!e)throw new Error("Url is not specified.");return new Promise((function(n,r){var i=new Image;i.onload=function(){t.handleImageLoad(e,i),n(i)},i.onerror=function(n){t.handleImageLoad(e,i),r(n)},i.style.display="none",i.src=e,document.body.appendChild(i)}))},t.prototype.handleImageLoad=function(e,t){if(!e)throw new Error("Url is not defined.");if(!t)throw new Error("Image element is not defined.");document.body.removeChild(t),t.removeAttribute("style")},t}(Z),K=function(){function e(){this._imageLoader=new J,this._audioLoader=new N}return e.getInstance=function(){return e._instance||(e._instance=new e),e._instance},Object.defineProperty(e.prototype,"loading",{get:function(){return this._imageLoader.loading||this._audioLoader.loading},enumerable:!1,configurable:!0}),e.prototype.load=function(e){var t=this;if(!e)throw new Error("Request for loading resources is not specified.");if(this.loading)throw new Error("Loading is already in progress.");return new Promise((function(n,r){var i,o,s=[t._imageLoader.load(null!==(i=e.imageUrls)&&void 0!==i?i:[]),t._audioLoader.load(null!==(o=e.audioUrls)&&void 0!==o?o:[])];Promise.all(s).then((function(t){var r,i,o=t[0],s=t[1],a={images:(null!==(r=e.imageUrls)&&void 0!==r?r:[]).map((function(e,t){return{url:e,element:o[t]}})),sounds:(null!==(i=e.audioUrls)&&void 0!==i?i:[]).map((function(e,t){return{url:e,element:s[t]}}))};n(a)})).catch((function(e){return r(e)}))}))},e}(),Q=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),X=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function s(e){try{c(r.next(e))}catch(e){o(e)}}function a(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}c((r=r.apply(e,t||[])).next())}))},Y=function(e,t){var n,r,i,o,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,r=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!(i=s.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){s=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){s.label=o[1];break}if(6===o[0]&&s.label<i[1]){s.label=i[1],i=o;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(o);break}i[2]&&s.ops.pop(),s.trys.pop();continue}o=t.call(e,s)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}},ee=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Q(t,e),Object.defineProperty(t.prototype,"isLoading",{get:function(){return this._isLoading},enumerable:!1,configurable:!0}),t.prototype.getImageElement=function(e){return this._imageElementStoreMap.get(e)},t.prototype.load=function(e){return X(this,void 0,void 0,(function(){var t,n,r=this;return Y(this,(function(i){switch(i.label){case 0:if(!e)throw new Error("Image ids are not specified.");t={imageUrls:e},i.label=1;case 1:return i.trys.push([1,3,4,5]),this._isLoading=!0,[4,K.getInstance().load(t)];case 2:return n=i.sent(),[3,5];case 3:throw i.sent();case 4:return this._isLoading=!1,[7];case 5:return this._imageElementStoreMap||(this._imageElementStoreMap=new Map),n.images.forEach((function(e){var t=e.url,n=e.element;r._imageElementStoreMap.set(t,n),r.imageStoreMap.set(t,new W(t,new y(n.width,n.height)))})),[2]}}))}))},t}(q),te=function(){function e(e,t){this.setCanvasEl(e),this.setCanvasContext(e.getContext("2d")),this.setAssetsManager(t)}return Object.defineProperty(e.prototype,"canvasEl",{get:function(){return this._canvasEl},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"canvasContext",{get:function(){return this._canvasContext},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"assetsManager",{get:function(){return this._assetsManager},enumerable:!1,configurable:!0}),e.prototype.clear=function(){var e=this.canvasEl,t=this.canvasContext;t.fillStyle="#000",t.fillRect(0,0,e.width,e.height)},e.prototype.drawImage=function(e){if(!e)throw new Error("Draw params are not specified.");var t=e.image,n=e.srcPoint,r=e.srcSize,i=e.destPoint,o=e.destSize,s=n.x,a=n.y,c=r.width,u=r.height,l=i.x,f=i.y,p=o.width,h=o.height,d=this.assetsManager.getImageElement(t.id);this.canvasContext.drawImage(d,s,a,c,u,l,f,p,h)},e.prototype.setCanvasEl=function(e){if(!e)throw new Error("Canvas element is not specified.");this._canvasEl=e},e.prototype.setCanvasContext=function(e){if(!e)throw new Error("Canvas context is not specified.");this._canvasContext=e},e.prototype.setAssetsManager=function(e){if(!e)throw new Error("Assets manager is not specified.");this._assetsManager=e},e}(),ne=function(){function e(e){this.setCanvasEl(e),this.onScreenTouch=new g}return Object.defineProperty(e.prototype,"isHandling",{get:function(){return Boolean(this._callback)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"canvasEl",{get:function(){return this._canvasEl},enumerable:!1,configurable:!0}),e.prototype.startHandling=function(){var e=this;if(this.isHandling)throw new Error("Player input is already being handled.");this._callback=function(t){var n=new d(t.x,t.y);e.onScreenTouch.emit(n)},this.canvasEl.addEventListener("click",this._callback)},e.prototype.stopHandling=function(){if(!this.isHandling)throw new Error("Player input is not being handled yet.");this.canvasEl.removeEventListener("click",this._callback),this._callback=null},e.prototype.setCanvasEl=function(e){if(!e)throw new Error("Canvas element is not specified.");this._canvasEl=e},e}(),re=function(){function e(t){void 0===t&&(t=e.defDelay),this.setDelay(t),this.onChange=new g}return Object.defineProperty(e.prototype,"delay",{get:function(){return this._delay},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isInProgress",{get:function(){return this._isInProgress},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"currentResolution",{get:function(){var t=e.indent,n=window.innerWidth-t,r=window.innerHeight-t;return n<e.minWidth&&(n=e.minWidth),r<e.minHeight&&(r=e.minHeight),new y(n,r)},enumerable:!1,configurable:!0}),e.prototype.startWatching=function(){var e=this;if(this.isInProgress)throw new Error("Resolution watching is already in progress.");this._isInProgress=!0,this._callback=function(){e._timeoutId&&clearTimeout(e._timeoutId),e._timeoutId=setTimeout((function(){e.onChange.emit(e.currentResolution)}),e.delay)},window.addEventListener("resize",this._callback)},e.prototype.stopWatching=function(){if(!this.isInProgress)throw new Error("Resolution observing has not been started yet.");if(!this._callback)throw new Error("Callback is not specified.");this._timeoutId&&clearTimeout(this._timeoutId),window.removeEventListener("resize",this._callback),this._callback=null,this._isInProgress=!1},e.prototype.setDelay=function(e){if(!e)throw new Error("Delay is not specified.");if(e<=0)throw new Error("Delay should be greater than 0.");this._delay=e},e.defDelay=20,e.indent=2,e.minWidth=140,e.minHeight=50,e}(),ie=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function s(e){try{c(r.next(e))}catch(e){o(e)}}function a(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}c((r=r.apply(e,t||[])).next())}))},oe=function(e,t){var n,r,i,o,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,r=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!(i=s.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){s=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){s.label=o[1];break}if(6===o[0]&&s.label<i[1]){s.label=i[1],i=o;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(o);break}i[2]&&s.ops.pop(),s.trys.pop();continue}o=t.call(e,s)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}};new(function(){function e(e){this.setRootElement(e)}return Object.defineProperty(e.prototype,"isRunning",{get:function(){return this._isRunning},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"rootEl",{get:function(){return this._rootEl},enumerable:!1,configurable:!0}),e.prototype.run=function(){return ie(this,void 0,void 0,(function(){var e,t,n,r,i,o,s,a,c=this;return oe(this,(function(u){switch(u.label){case 0:if(this._isRunning)throw new Error("The app is already running.");return this._isRunning=!0,e=new re,t=e.currentResolution,n=this.createCanvasEl(t.width,t.height),e.onChange.attach((function(){var t=e.currentResolution,r=t.width,i=t.height;n.width=r,n.height=i})),e.startWatching(),r=new H,i=new ee,o=new ne(n),s=new te(n,i),(a=new G({graphicContext:s,animator:r,resolutionWacther:e,playerInput:o})).changeCurrentLevel(new T(i)),a.currentLevel.onVictory.attach((function(){o.stopHandling(),c.addVictoryElements()})),[4,a.currentLevel.load()];case 1:return u.sent(),this.removeLoaderElement(),this.addCanvas(n),r.startAnimating(),o.startHandling(),a.setUpdatingStatus(!0),a.setRenderingStatus(!0),[2]}}))}))},e.prototype.createCanvasEl=function(e,t){var n=document.createElement("canvas");return n.width=e,n.height=t,n},e.prototype.createDarkLayerElement=function(){var e=document.createElement("div");return e.classList.add("dark-layer"),e},e.prototype.createVictoryElement=function(){var e=document.createElement("div");e.classList.add("victory");var t=document.createElement("div");return t.textContent="Riddle Solved!",e.appendChild(t),(t=document.createElement("div")).textContent="Congratulations!",e.appendChild(t),e},e.prototype.addCanvas=function(e){if(!e)throw new Error("Canvas element is not specified.");this._rootEl.appendChild(e)},e.prototype.addVictoryElements=function(){var e=this.createDarkLayerElement();this.rootEl.appendChild(e);var t=this.createVictoryElement();this.rootEl.appendChild(t)},e.prototype.removeLoaderElement=function(){var e=document.querySelector(".loader-wrapper");this._rootEl.removeChild(e)},e.prototype.setRootElement=function(e){if(!e)throw new Error("Root element is not specified.");this._rootEl=e},e}())(document.getElementById("root")).run()}()}();
//# sourceMappingURL=main.7912ed018aa3a6fbc3d4.js.map